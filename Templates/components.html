## components.html

<%def name="layoutControlList(configItem,dataItem)">
<table class="table table-normal table-condensed">
    %for member in configItem:
        <%
        itemMember=configItem[member]
        i = 0
        %>
        %for subMember in itemMember:
            <%
            subItemMember = itemMember[subMember]
            %>
            %if i%2 == 0:
                <tr>
            %endif
            ${layoutControl(item=subItemMember,dataItem=dataItem)}
            <%
            i = i+1
            %>
            %if i%2 == 0:
                </tr>
            %endif
        %endfor
        <% break %>
    %endfor

    <%
    if len(configItem) > 0:
        configItem.pop(member)
    %>
</table>
</%def>

##parameter:
##item -> 配置项
##dataItem -> 数据项,多条数据,可以传None
<%def name="layoutControl(item,dataItem)">
				<%
				realDataValue = ''
				if "controlName" in item:
					dataValueName = item["controlName"]
					if dataItem is not None:
						if dataValueName in dataItem:
							realDataValue = dataItem[dataValueName]
						else:
							realDataValue = ''
					else:
						realDataValue = ''
				%>
                %if 'tableColSpan' in item:
                    <td colspan="${item['tableColSpan']}">
                %else:
                    <td>
                %endif
					%if item["controlType"] == 'label':
						%if 'mustHave' in item:
							%if item.as_bool('mustHave'):
								<${item["controlType"]} class="${item["controlCss"]}"><span style="color: red">*</span>${item["controlText"]}</${item["controlType"]}>
							%else:
								<${item["controlType"]} class="${item["controlCss"]}">${item["controlText"]}</${item["controlType"]}>
                        %endif
						%else:
							<${item["controlType"]} class="${item["controlCss"]}">${item["controlText"]}</${item["controlType"]}>
						%endif
                    %elif item["controlType"] == 'input':
                        %if item["controlShowType"] == 'text':
                            %if "placeholder" in item:
                                <${item["controlType"]} name=${item["controlName"]} id=${item["controlID"]} type = ${item["controlShowType"]} class="${item["controlCss"]}" value="${realDataValue}" placeholder="${item["placeholder"]}"/>
                            %else:
                                <${item["controlType"]} name=${item["controlName"]} id=${item["controlID"]} type = ${item["controlShowType"]} class="${item["controlCss"]}" value="${realDataValue}"/>
                            %endif
                        %elif item["controlShowType"] == 'textDate':
                            <${item["controlType"]} name=${item["controlName"]} id=${item["controlID"]} type = ${item["dataRealShowType"]} class="${item["controlCss"]}" value="${realDataValue}" onclick="${item["onClick"]}"/>
                        %elif item["controlShowType"] == 'radio':
                            <%
                                if realDataValue == '':
                                    #default value
                                    realDataValue = None
                            %>
                            %for radioItem in item["radio"]:
                                <%
                                    radioItemData = item["radio"][radioItem]
                                %>
                                <${radioItemData["titleType"]} class="${radioItemData["titleCss"]}">
                                    %if realDataValue == radioItemData["inDataValue"]:
                                        <${item["controlType"]} name=${item["controlName"]} id=${radioItemData["inDataID"]} type = "${item["controlShowType"]}" value="${radioItemData["inDataValue"]}" checked/>
                                    %else:
                                        <${item["controlType"]} name=${item["controlName"]} id=${radioItemData["inDataID"]} type = "${item["controlShowType"]}" value="${radioItemData["inDataValue"]}"/>
                                    %endif
                                        <${radioItemData["inDataType"]} class="${radioItemData["inDataCss"]}"> ${radioItemData["inDataText"]}</${radioItemData["inDataType"]}>
                                </${radioItemData["titleType"]}>
                                <script type="text/javascript" language="javascript">

                                </script>
                            %endfor
                        %endif
                    %elif item["controlType"] == 'select':
                        ##now , we do not use selectSingle. all data from db or config file.
                        %if item["controlShowType"] == 'selectSingle':
                            <${item["controlType"]} name=${item["controlName"]} id=${item["controlID"]}  class="${item["controlCss"]}">
                            %for selectItem in item["select"]:
                                <%
                                    selectItemData = item["select"][selectItem]
                                %>
                                %if selectItemData["inDataValue"] ==  realDataValue:
                                    <${selectItemData["titleType"]} value="${selectItemData["inDataValue"]}" selected>${selectItemData["inDataText"]}</${selectItemData["titleType"]}>
                                %else:
                                    <${selectItemData["titleType"]} value="${selectItemData["inDataValue"]}">${selectItemData["inDataText"]}</${selectItemData["titleType"]}>
                                %endif
                            %endfor
                            </${item["controlType"]}>
                        %elif item["controlShowType"] == 'selectConf':
                            <%
                                dataDict = getDictStatic(item["dataSourceId"])
                            %>
                            <${item["controlType"]} name=${item["controlName"]} id=${item["controlID"]}  class="${item["controlCss"]}">
                            %if "needShowExt" in item:
                                %if realDataValue is None:
                                    <${item["dataTitleType"]} value="${item["needShowExtValue"]}" selected>${item["needShowExt"]}</${item["dataTitleType"]}>
                                %else:
                                    <${item["dataTitleType"]} value="${item["needShowExtValue"]}">${item["needShowExt"]}</${item["dataTitleType"]}>
                                %endif
                            %endif
                            %for selectItem in dataDict:
                                <%
                                    selectItemData = dataDict[selectItem]
                                    ##print selectItemData["value"]
                                %>
                                %if selectItemData["value"] ==  realDataValue:
                                    <${item["dataTitleType"]} value="${selectItemData["value"]}" selected>${selectItemData["text"]}</${item["dataTitleType"]}>
                                %else:
                                    <${item["dataTitleType"]} value="${selectItemData["value"]}">${selectItemData["text"]}</${item["dataTitleType"]}>
                                %endif
                            %endfor
                            </${item["controlType"]}>
                            %if "defaultValue" in item:
                                %if realDataValue == '':
                                    <script type="text/javascript" language="javascript">
                                        var selectText = function(dropdown, selectedValue) {
                                            var options = $(dropdown).find("option");
                                            var matches = $.grep(options,
                                                    function(n) { return $(n).text() == selectedValue; });
                                            $(matches).attr("selected", "selected");
                                        };
                                        selectText('#${item["controlID"]}','${item["defaultValue"]}');
                                    </script>
                                %endif
                            %endif
                        %elif item["controlShowType"] == 'selectBriefAddress':
                            <%
                            setScript = ''
                            %>
                            %for selectItem in item["select"]:
                                <%
                                selectItemData = item["select"][selectItem]
                                %>
                                %if "onchange" in selectItemData:
                                    <${selectItemData["titleType"]} id="${selectItemData["inDataID"]}"  name="${selectItemData["inDataName"]}" class="${selectItemData["inDataCss"]}" onchange="${selectItemData["onchange"]}" ></${selectItemData["titleType"]}>
                                %else:
                                    <${selectItemData["titleType"]} id="${selectItemData["inDataID"]}"  name="${selectItemData["inDataName"]}" class="${selectItemData["inDataCss"]}" ></${selectItemData["titleType"]}>
                                %endif
                                <%
                                if "inDataName" in selectItemData:
                                    dataValueName = selectItemData["inDataName"]
                                if dataItem is not None:
                                    if dataValueName in dataItem:
                                        realDataValue = dataItem[dataValueName]
                                    else:
                                        realDataValue = ''
                                else:
                                    realDataValue = ''
                                %>
                                <%
                                print selectItemData["inDataID"]+' realDataValue is :'+realDataValue
                                if (realDataValue is not None) & (realDataValue != ''):
                                    setScript = setScript + 'jQuery("#'+selectItemData["inDataID"]+'").val('+realDataValue+');'+'\r'
                                    if "onSetValueDataID" in selectItemData:
                                        setScript = setScript + 'changevalCityIns(document.getElementById("'+selectItemData["onSetValueDataID"]+'"),'+realDataValue+');' + '\r'
                                else:
                                    setScript = setScript + '\r'
                                endif
                                %>
                            %endfor
                            <script type="text/javascript" language="javascript">
                                ${item["scriptFile"]}
                            </script>
                            %if setScript != '':
                                <script type="text/javascript" language="javascript">
                                    ${setScript}
                                </script>
                            %endif
                        %endif
                    %endif
                </td>
</%def>

